<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de Carrito - ODYM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-center mb-8">Test de Integración de Carrito</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- Producto de prueba -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold mb-4">Producto de Prueba</h2>
                <div class="space-y-4">
                    <button onclick="testAddToCart()" class="w-full bg-orange-600 text-white py-2 px-4 rounded">
                        Test: Agregar al carrito
                    </button>
                    <button onclick="testViewCart()" class="w-full bg-blue-600 text-white py-2 px-4 rounded">
                        Test: Ver carrito
                    </button>
                    <button onclick="testClearCart()" class="w-full bg-red-600 text-white py-2 px-4 rounded">
                        Test: Limpiar carrito
                    </button>
                </div>
            </div>
            
            <!-- Estado del carrito -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold mb-4">Estado del Carrito</h2>
                <div id="cartStatus" class="space-y-2">
                    <p>Carrito: <span id="cartCount">0</span> items</p>
                    <p>Total: $<span id="cartTotal">0.00</span></p>
                </div>
                <div id="cartItemsDisplay" class="mt-4 space-y-2">
                    <!-- Items del carrito -->
                </div>
            </div>
        </div>
        
        <!-- Debug info -->
        <div class="mt-8 bg-gray-200 p-4 rounded">
            <h3 class="font-semibold mb-2">Debug Info</h3>
            <pre id="debugInfo" class="text-sm"></pre>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/cart-fixed.js"></script>
    <script>
        const API_BASE_URL = 'http://localhost:3000/api';
        
        function updateDebugInfo() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const debugInfo = {
                cart: cart,
                localStorage: {
                    cart: localStorage.getItem('cart'),
                    checkoutSession: localStorage.getItem('checkoutSession')
                },
                functions: {
                    addToCart: typeof addToCart,
                    handleAddToCart: typeof handleAddToCart,
                    toggleCart: typeof toggleCart,
                    proceedToCheckout: typeof proceedToCheckout
                }
            };
            document.getElementById('debugInfo').textContent = JSON.stringify(debugInfo, null, 2);
        }
        
        function testAddToCart() {
            handleAddToCart('507f1f77bcf86cd799439011', 2);
            updateCartDisplay();
        }
        
        function testViewCart() {
            if (typeof toggleCart === 'function') {
                toggleCart();
            } else {
                alert('Función toggleCart no disponible');
            }
        }
        
        function testClearCart() {
            localStorage.removeItem('cart');
            updateCartDisplay();
            showNotification('Carrito limpiado', 'info');
        }
        
        function updateCartDisplay() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const count = cart.reduce((total, item) => total + item.quantity, 0);
            const total = cart.reduce((sum, item) => sum + (item.product?.price || 0) * item.quantity, 0);
            
            document.getElementById('cartCount').textContent = count;
            document.getElementById('cartTotal').textContent = total.toFixed(2);
            
            const itemsDisplay = document.getElementById('cartItemsDisplay');
            itemsDisplay.innerHTML = '';
            
            cart.forEach(item => {
                const div = document.createElement('div');
                div.className = 'border-b pb-2';
                div.innerHTML = `
                    <p>${item.product?.name || 'Producto'} x ${item.quantity}</p>
                    <p class="text-sm text-gray-600">$${(item.product?.price || 0).toFixed(2)} c/u</p>
                `;
                itemsDisplay.appendChild(div);
            });
        }
        
        // Actualizar al cargar
        document.addEventListener('DOMContentLoaded', function() {
            updateCartDisplay();
            updateDebugInfo();
            console.log('Test de carrito cargado');
        });
    </script>
</body>
</html>
